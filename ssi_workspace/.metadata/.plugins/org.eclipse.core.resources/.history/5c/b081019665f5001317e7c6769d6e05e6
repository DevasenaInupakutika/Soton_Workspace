package com.example.ssitestapp;

import java.io.StringReader;
import java.util.ArrayList;
import java.util.List;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

import org.w3c.dom.Document;
import org.w3c.dom.NodeList;
import org.xml.sax.InputSource;

import android.util.Log;

/**
 * Mimic the server side logic to return results with some delay
 */

public class BlogRemoteService {
	private static final String TAG = BlogRemoteService.class.getSimpleName();
	
	private int blogIdx = 0;
	private static final String RSSFEEDURL = "http://www.software.ac.uk/blog/rss-all";
	
	DOMParser myParser;
	String xml = myParser.getXmlFromUrl(RSSFEEDURL);
	private int length = 0;
	
	public List<RSSItem> getNextBlogBatch(int batchSize){
		
		Document doc = null;
		DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
		
			DocumentBuilder db = dbf.newDocumentBuilder();

			// Parse the xml
			InputSource is = new InputSource();
            is.setCharacterStream(new StringReader(xml));
            doc = db.parse(is); 
			doc.getDocumentElement().normalize();

			// Get all <item> tags i.e. Root node of each section we want to parse.
			NodeList nl = doc.getElementsByTagName("item"); //Parent node
			length = nl.getLength();
		
		List<RSSItem> results = new ArrayList<RSSItem>();
    	try {
			for (int i = blogIdx; i < (blogIdx + batchSize < sushiEntries.length ? blogIdx + batchSize : sushiEntries.length); i++) {
		    	results.add(sushiEntries[i]);
				if (blogIdx != 0) {
					// Delay when retrieving each item
					Thread.sleep(400L);
				}
		    }
	    	// Keep track where the pointer is
			blogIdx = blogIdx + batchSize;
		} catch (InterruptedException e) {
			blogIdx = 0;
			results.clear();
			Log.i(TAG, "Blog service interrupted");
		}
		return results;
		
	}
	

}
