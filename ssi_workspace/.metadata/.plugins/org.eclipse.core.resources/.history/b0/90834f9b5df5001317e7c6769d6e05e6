package com.example.ssitestapp;

import java.util.List;

import com.example.ssitestapp.InfiniteScrollListView.LoadingMode;
import com.example.ssitestapp.InfiniteScrollListView.StopPosition;
import com.example.ssitestapp.BlogListAdapter.NewPageListener;

import android.app.Activity;
import android.content.Context;
import android.os.AsyncTask;
import android.os.Bundle;
import android.os.Handler;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.TextView;

public class InfiniteScrollListActivity extends Activity{
		
	// A setting for how many items should be loaded at once from the server (software.ac.uk)
	
	private static final int SERVER_SIDE_BATCH_SIDE = 10;
	private static final String RSSFEEDURL = "http://www.software.ac.uk/blog/rss-all";
	
	private InfiniteScrollListView lv;
	private ImageView iv;
	private ImageLoader imageLoader;
	private TextView tvTitle;
	private TextView tvDate;
	
	private BlogListAdapter bloglistAdapter;
	private Handler handler;
	
	private AsyncTask<Void, Void, List<RSSItem>> fetchAsyncTask;
	private RSSFeed feed;
	
	private LoadingMode loadingMode = LoadingMode.SCROLL_TO_BOTTOM;
	private StopPosition stopPosition = StopPosition.REMAIN_UNCHANGED;

	public InfiniteScrollListActivity(){
		super();
		// Get feed from the file
				feed = (RSSFeed) getIntent().getExtras().get("feed");
	}
	
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.feed_list);
		
		getActionBar().setDisplayHomeAsUpEnabled(true);
		
		handler = new Handler();
		
		// Initialise the variables
		lv = (InfiniteScrollListView) findViewById(R.id.listView);
		lv.setVerticalFadingEdgeEnabled(true);
		
		lv.setLoadingMode(loadingMode);
		LayoutInflater layoutInflater = (LayoutInflater) getSystemService(Context.LAYOUT_INFLATER_SERVICE);
		lv.setLoadingView(layoutInflater.inflate(R.layout.list_item,null));
		
		imageLoader = new ImageLoader(getApplicationContext());
		iv = (ImageView) findViewById(R.id.thumb);
		tvTitle = (TextView) findViewById(R.id.title);
		tvDate = (TextView) findViewById(R.id.date);
		
		bloglistAdapter = new BlogListAdapter(new NewPageListener(){

			@Override
			public void onScrollNext() {
				// TODO Auto-generated method stub
				fetchAsyncTask = new AsyncTask<Void,Void,List<RSSItem>>(){

					@Override
					protected void onPreExecute() {
						// Loading lock to allow only one instance of loading
                    	bloglistAdapter.lock();
					}
					@Override
					protected List<RSSItem> doInBackground(Void... params) {
						// TODO Auto-generated method stub
						List<RSSItem> result;
						//Mimic loading from a remote service.
						return null;
					}
					
				}
				
			}

			@Override
			public View getInfiniteScrollListView(int position,
					View convertView, ViewGroup parent) {
				// TODO Auto-generated method stub
				return null;
			}
			
			
		});
		
		
	}
}
